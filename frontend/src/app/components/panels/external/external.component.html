<div class="panel-style external-panel">
  <div class="content">
    <div class="title">
      <h1>
        External Input

        <fa-icon
          *ngIf="!backendConnected"
          [icon]="errorIcon"
          [ngClass]="{
            'icon-button': true,
            'non-hover-icon': true,
            'red-icon': true,
          }"
          title="Could not connect to backend. Converting files unavailable"
        ></fa-icon>
      </h1>

      <div class="right-buttons">
        <p-buttongroup>
          <button
            pButton
            pRipple
            type="button"
            severity="primary"
            label="Upload Data"
            (click)="toggleImportData()"
            variant="outlined"
            [ngClass]="{ selected: !importData }"
            disabled
            title="(Disabled) Only Uploading Data is Currently Available"
          ></button>
          <button
            pButton
            pRipple
            type="button"
            severity="primary"
            label="Input Data"
            (click)="toggleImportData()"
            variant="outlined"
            [ngClass]="{ selected: importData }"
            disabled
            title="(Disabled) Only Uploading Data is Currently Available"
          ></button>
        </p-buttongroup>
      </div>
    </div>

    <form class="formGroup" [formGroup]="formGroup">
      <div class="container">
        <app-card
          *ngIf="importData; else uploadData"
          formGroupName="import"
          header="Import External Input"
        >
          <div class="container">
            <div class="row">
              <div class="col">
                <label name="ogStartTime" for="ogStartTime"> Start Time </label>
                <input
                  type="datetime-local"
                  formControlName="ogStartTime"
                  [max]="maxDateTime"
                />

                <label name="ogEndTime" for="ogEndTime"> End Time </label>
                <input
                  type="datetime-local"
                  formControlName="ogEndTime"
                  [max]="maxDateTime"
                />
              </div>

              <div class="col">
                <div class="col downwards">
                  <label title="feeds">Data Feeds</label>

                  <div class="row-1">
                    <input
                      type="checkbox"
                      class="checkbox"
                      id="type1"
                      formControlName="type1"
                      placeholder="type1"
                    />
                    <label title="feeds" for="type1">Type 1</label>
                  </div>
                  <div class="row-1">
                    <input
                      type="checkbox"
                      class="checkbox"
                      id="type2"
                      formControlName="type2"
                      placeholder="type2"
                    />
                    <label title="feeds" for="type2">Type 2</label>
                  </div>
                  <div class="row-1">
                    <input
                      type="checkbox"
                      class="checkbox"
                      id="type3"
                      formControlName="type3"
                      placeholder="type3"
                    />
                    <label title="feeds" for="type3">Type 3</label>
                  </div>
                  <div class="row-1">
                    <input
                      type="checkbox"
                      class="checkbox"
                      id="type4"
                      formControlName="type4"
                      placeholder="type4"
                    />
                    <label title="feeds" for="type4">Type 4</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="labelAndTooltip">
            <label name="ogStartTime" for="ogStartTime">New Start Time</label>
            <i
              class="bi bi-info-circle info"
              title="All times will be modified based on the difference between 'Original Start Time' and 'New Start Time'"
            ></i>
          </div>

          <input type="datetime-local" formControlName="newStartTime" />
        </app-card>
      </div>
    </form>

    <ng-template #uploadData>
      <div class="row">
        <app-card header="Upload External Input">
          <!-- TODO either add back in or remove -->
          <!-- <select [(ngModel)]="timeZone" name="timeZone" size="small">
            <option
              *ngFor="let option of timeZoneOptions"
              [value]="option.value"
            >
              {{ option.name }}
            </option>
          </select> -->

          <div class="labelAndTooltip">
            <label name="ogStartTime" for="newStartTime">
              New Start Time (UTC)
            </label>
            <i
              class="bi bi-info-circle info"
              title="All times will be modified based on the difference between 'Original Start Time' and 'New Start Time'"
            ></i>
          </div>
          <input
            type="datetime-local"
            [value]="localInputValue"
            (blur)="onDateTimeChange($event)"
          />
          <!-- TODO either add back in or remove -->
          <!-- <input
            type="datetime-local"
            [value]="localInputValue"
            (blur)="dateTimeUpdated($event)"
          /> -->

          <label for="uploadFromFile">Upload From CSV</label>
          <input
            [ngClass]="{
              'form-control': true,
              'red-outline': fileState === 'INVALID',
            }"
            type="file"
            id="uploadFromFile"
            (change)="onFileSelected($event)"
            accept=".csv"
            [disabled]="
              fileState == 'WAITING_FOR_CONVERSION' || !backendConnected
            "
          />
          <span *ngIf="fileState === 'INVALID'" class="red-text">
            File can only be of type CSV
          </span>
          <br />
          <button
            [disabled]="!selectedFile || fileState === 'INVALID'"
            (click)="uploadAndConvert()"
          >
            Convert File
            <fa-icon
              *ngIf="
                fileState === 'WAITING_FOR_CONVERSION' ||
                fileState === 'ERROR_CONVERTING'
              "
              [icon]="
                fileState === 'WAITING_FOR_CONVERSION' ? spinnerIcon : errorIcon
              "
              [ngClass]="{
                'icon-button': true,
                'fa-spin': fileState === 'WAITING_FOR_CONVERSION',
                'red-icon': fileState === 'ERROR_CONVERTING',
              }"
            ></fa-icon>
          </button>
        </app-card>
      </div>
    </ng-template>
  </div>
</div>
